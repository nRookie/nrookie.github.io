

## *Designing an API Rate Limiter*

*Let's design*



1. *1. What is a Rate Limiter?*



*Imagine we have a service which is receiving a huge number of requests, but it can only serve a limited* *number of requests per second. To handle this problem we would need some kind of throttling or rate*

*limiting mechanism that would allow only a certain number of requests so our service can respond to*

*all of them. A rate limiter, at a high-level, limits the number of events an entity (user, device, IP, etc.)*

*can perform in a particular time window. For example:*





- A user can send only one message per second.*
- A user is allowed only three failed credit card transactions per day.*
- *A single IP can only create twenty accounts per day.*



*In general, a rate limiter caps how many requests a sender can issue in a specific time window. It then* *blocks requests once the cap is reached.*





### *2. Why do we need API rate limiting?*



*Rate Limiting helps to protect services against abusive behaviors targeting the application layer like* *Denial-of-service (DOS)* *attacks*



*brute-force password attempts, brute-force credit card transactions,*

*etc. These attacks are usually a barrage of HTTP/S requests which may look like they are coming from* real users, but are typically generated by machines (or bots). As a result, these attacks are often harder to detect and can more easily bring down a service, application, or an API.*





*Rate limiting is also used to prevent revenue loss, to reduce infrastructure costs, to stop spam, and to *stop online harassment. Following is a list of scenarios that can benefit from Rate limiting by making a service (or API) more reliable:*



*Misbehaving clients/scripts: Either intentionally or unintentionally, some entities can*

*overwhelm a service by sending a large number of requests. Another scenario could be when a* *user is sending a lot of lower-priority requests and we want to make sure that it doesn’t affect* *the high-priority traffic. For example, users sending a high volume of requests for analytics data* *should not be allowed to hamper critical transactions for other users.*





Security: By limiting the number of the second-factor attempts (in 2-factor auth) that the users are allowed to perform, for example, the number of times they’re allowed to try with a wrong password.



*To prevent abusive behavior and bad design practices: Without API limits, developers of*

*client applications would use sloppy development tactics, for example, requesting the same*information over and over again.



- *To keep costs and resource usage under control: Services are generally designed for normal*

  *input behavior, for example, a user writing a single post in a minute. Computers could easily*

  *push thousands/second through an API. Rate limiter enables controls on service APIs.*





*Revenue:* *Certain services might want to limit operations based on the tier of their customer’s*

*service and thus create a revenue model based on rate limiting. There could be default limits for* *all the APIs a service offers. To go beyond that, the user has to buy higher limits*





*To eliminate spikiness in traffic: Make sure the service stays up for everyone else.*





3. Requirements and Goals of the System



*Our Rate Limiter should meet the following requirements:*





1. Limit the number of requests an entity can send to an API within a time window, e.g., 15 *requests per second.

2. The APIs are accessible through a cluster, so the rate limit should be considered across different servers. The user should get an error message whenever the defined threshold is crossed within a single server or across a combination of servers.

   

   

### Non-Functional Requirements:



1. The system should be highly available. The rate limiter should always work since it protects our service from external attacks.
2. Our rate limiter should not introduce substantial latencies affecting the user experience.



### How to do Rate Limiting ?



####  



Rate Limiting is a process that is used to define the rate and speed at which consumers can access APIs, Throttling is the process of controlling the usage of the APIs by customers during a given period. Throttling can be defined at the application level and/or API level. When a throttle limit is crossed, the server returns HTTP status "429- Too many requests".





5. What are different types of throttling ?



Here are the three famous throttling types that are used by different services



node.next = head.next

head.next = node 

Node.next = head 

head = node